# =============================================================================
# ENVIRONNEMENT (IMPORTANT !)
# =============================================================================
# development = Ollama uniquement (0€, pas de consommation cloud)
# production = Cloud providers (Gemini, DeepSeek) - payants
NODE_ENV=development

# ----------------------------------------------------------------------------
# Database PostgreSQL
# ----------------------------------------------------------------------------
DB_USER=moncabinet
DB_PASSWORD=dev_password_change_in_production
DATABASE_URL=postgresql://moncabinet:dev_password_change_in_production@localhost:5433/moncabinet

# ----------------------------------------------------------------------------
# MinIO Storage
# ----------------------------------------------------------------------------
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin123
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_BUCKET=documents

# ----------------------------------------------------------------------------
# Redis Cache
# ----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379

# ----------------------------------------------------------------------------
# Resend (Email Service - WhatsApp notifications)
RESEND_API_KEY=re_your_api_key
RESEND_FROM_EMAIL=notifications@qadhya.tn

# Brevo (Email Service - Notifications quotidiennes)
# Obtenir une clé: https://app.brevo.com/settings/keys/api
BREVO_API_KEY=xkeysib-...
BREVO_SENDER_EMAIL=notifications@qadhya.tn
BREVO_SENDER_NAME=Qadhya

# Cron Jobs (Notifications quotidiennes)
# Générer avec: openssl rand -hex 32
# Utilisé pour sécuriser l'endpoint /api/cron/daily-digest
CRON_SECRET=your-random-cron-secret-min-32-chars

# Google Drive OAuth (Cloud Storage)
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:7002/api/integrations/google-drive/callback
GOOGLE_DRIVE_WEBHOOK_VERIFY_TOKEN=your-random-verify-token-min-32-chars

# WhatsApp Business API (Messaging)
WHATSAPP_WEBHOOK_VERIFY_TOKEN=your-random-verify-token-min-20-chars
WHATSAPP_APP_SECRET=your-meta-app-secret

# Application
NEXT_PUBLIC_APP_URL=http://localhost:7002
NEXT_PUBLIC_APP_NAME=Qadhya
NEXT_PUBLIC_APP_DOMAIN=qadhya.tn

# Security - Encryption Key pour chiffrer tokens Google Drive
# Générer avec: openssl rand -hex 32
# IMPORTANT: Ne JAMAIS commit cette clé dans Git!
ENCRYPTION_KEY=your-64-char-hex-key-generated-with-openssl-rand-hex-32-here

# Environment
NODE_ENV=development

# =============================================================================
# IA / RAG Configuration
# =============================================================================

# Anthropic Claude (LLM principal pour chat et génération)
# Obtenir une clé: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-api03-...
ANTHROPIC_MODEL=claude-sonnet-4-20250514

# Groq (LLM rapide et économique - prioritaire si configuré)
# Obtenir une clé: https://console.groq.com/keys
GROQ_API_KEY=gsk_...
GROQ_MODEL=llama-3.3-70b-versatile

# DeepSeek (LLM économique - fallback après Groq)
# Obtenir une clé: https://platform.deepseek.com/api_keys
DEEPSEEK_API_KEY=sk-...
DEEPSEEK_MODEL=deepseek-chat

# Google Gemini 2.0 Flash-Lite (RECOMMANDÉ Février 2026)
# Tier gratuit illimité (input/output) avec rate limit 15 RPM
# Tier payant: $0.075/M input, $0.30/M output
# Contexte 1M tokens (excellent pour longs PDFs)
# Obtenir une clé: https://aistudio.google.com/app/apikey
GOOGLE_API_KEY=AIzaSy...
GEMINI_MODEL=gemini-2.0-flash-lite
GEMINI_MAX_TOKENS=4000

# Ollama (RECOMMANDÉ - LLM + Embeddings gratuits, locaux, illimités)
# Installation: brew install ollama && ollama serve
# Télécharger modèles:
#   ollama pull qwen3:8b                    # Chat rapide
#   ollama pull qwen3-embedding:0.6b        # Embeddings
# Mode Hybride Intelligent (Option C) :
#   - Mode Rapide : Ollama qwen3:8b local (gratuit, ~15-20s)
#   - Mode Premium : Cloud providers (Groq/DeepSeek/Anthropic via API)
OLLAMA_ENABLED=true
OLLAMA_BASE_URL=http://localhost:11434

# Chat Model Ollama (Mode Rapide uniquement)
OLLAMA_CHAT_MODEL=qwen3:8b

# Embedding Model Ollama (1024 dimensions)
OLLAMA_EMBEDDING_MODEL=qwen3-embedding:0.6b

# Timeout Ollama (millisecondes)
OLLAMA_CHAT_TIMEOUT_DEFAULT=120000           # 2 min pour qwen3:8b

# Note: OLLAMA_CHAT_MODEL_PREMIUM et OLLAMA_CHAT_TIMEOUT_PREMIUM
# ne sont plus utilisés (Option C = cloud providers pour mode premium)

# RAG Configuration
RAG_ENABLED=false
RAG_CHUNK_SIZE=1024
RAG_CHUNK_OVERLAP=100
RAG_MAX_RESULTS=5
RAG_SIMILARITY_THRESHOLD=0.7

# RAG Seuils par type de source (optionnel)
RAG_THRESHOLD_DOCUMENTS=0.7
RAG_THRESHOLD_JURISPRUDENCE=0.6
RAG_THRESHOLD_KB=0.65
RAG_THRESHOLD_MIN=0.5

# RAG Diversité des sources (optionnel)
RAG_MAX_CHUNKS_PER_SOURCE=2
RAG_MIN_SOURCES=2

# RAG Limite contexte (tokens max pour le contexte)
RAG_MAX_CONTEXT_TOKENS=2000

# =============================================================================
# Cache Redis (Semantic Cache)
# =============================================================================

# TTL Cache embeddings (secondes) - défaut: 7 jours
EMBEDDING_CACHE_TTL=604800

# TTL Cache recherche (secondes) - défaut: 1 heure
SEARCH_CACHE_TTL=3600

# Seuil similarité pour cache hit - défaut: 0.95
SEARCH_CACHE_THRESHOLD=0.95

# =============================================================================
# Query Expansion (Recherche bilingue AR↔FR)
# =============================================================================

# Activer la recherche bilingue (true/false)
ENABLE_QUERY_EXPANSION=true

# Modèle de traduction (Groq)
TRANSLATION_MODEL=llama-3.1-8b-instant

# =============================================================================
# Indexation Async
# =============================================================================

# Nombre de jobs à traiter par batch
INDEXING_BATCH_SIZE=5

# Nombre max de tentatives par job
INDEXING_MAX_ATTEMPTS=3

# Seuil mémoire pour backpressure (% heap, défaut: 80)
# Au-delà de ce seuil, l'indexation pause automatiquement
INDEXING_MEMORY_THRESHOLD_PERCENT=80

# TTL jobs orphelins (minutes, défaut: 15)
# Jobs bloqués en 'processing' au-delà de ce délai sont récupérés automatiquement
INDEXING_JOB_TTL_MINUTES=15

# Streaming PDF (défaut: true)
# Active le téléchargement en stream pour réduire empreinte mémoire (60%)
USE_STREAMING_PDF=true

# Quotas IA (par utilisateur)
AI_MONTHLY_QUOTA_DEFAULT=100
AI_MAX_TOKENS_PER_REQUEST=4000

# =============================================================================
# Backups Configuration
# =============================================================================

# Répertoire des backups (doit exister et avoir les permissions)
BACKUP_DIR=/opt/backups/qadhya

# Script de backup (chemin absolu)
BACKUP_SCRIPT=/opt/qadhya/backup.sh

# Email admin pour alertes backup (utilise Brevo)
ADMIN_EMAIL=admin@qadhya.tn
